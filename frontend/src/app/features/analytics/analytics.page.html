<div class="analytics-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <p-progressSpinner></p-progressSpinner>
    <p>Loading analytics...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading">
    
    <!-- Page Header -->
    <div class="page-header">
      <h1>Platform Analytics</h1>
      <p>Market overview and performance metrics</p>
    </div>

    <!-- Metrics Grid -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-icon">ðŸ“Š</div>
        <div class="metric-content">
          <div class="metric-label">Total Market Cap</div>
          <div class="metric-value">{{ formatCurrency(metrics.totalValue) }}</div>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">ðŸª™</div>
        <div class="metric-content">
          <div class="metric-label">Total Tokens</div>
          <div class="metric-value">{{ metrics.totalTokens }}</div>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">ðŸ’°</div>
        <div class="metric-content">
          <div class="metric-label">Avg Market Cap</div>
          <div class="metric-value">{{ formatCurrency(metrics.avgMarketCap) }}</div>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">ðŸ“ˆ</div>
        <div class="metric-content">
          <div class="metric-label">24h Volume</div>
          <div class="metric-value">{{ formatCurrency(metrics.totalVolume) }}</div>
        </div>
      </div>
    </div>

    <!-- Performance Chart -->
    <div class="chart-card">
      <div class="chart-header">
        <h3>Market Performance</h3>
        <div class="timeframe-selector">
          <button 
            [class.active]="selectedTimeframe === '1D'"
            (click)="selectTimeframe('1D')">1D</button>
          <button 
            [class.active]="selectedTimeframe === '1W'"
            (click)="selectTimeframe('1W')">1W</button>
          <button 
            [class.active]="selectedTimeframe === '1M'"
            (click)="selectTimeframe('1M')">1M</button>
          <button 
            [class.active]="selectedTimeframe === 'ALL'"
            (click)="selectTimeframe('ALL')">ALL</button>
        </div>
      </div>
      
      <div class="chart-container">
        <svg viewBox="0 0 100 100" preserveAspectRatio="none">
          <defs>
            <linearGradient id="chartGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#8b5cf6" stop-opacity="0.3"/>
              <stop offset="100%" stop-color="#8b5cf6" stop-opacity="0"/>
            </linearGradient>
          </defs>
          
          <path 
            [attr.d]="getChartGradientPath()" 
            fill="url(#chartGradient)"/>
          
          <path 
            [attr.d]="getChartPath()" 
            stroke="#8b5cf6"
            stroke-width="0.5" 
            fill="none"
            class="chart-line"/>
        </svg>
        
        <div class="chart-labels">
          <span *ngFor="let label of chartData.labels; let i = index" 
                [style.left.%]="(i / (chartData.labels.length - 1)) * 100"
                class="chart-label">
            {{ label }}
          </span>
        </div>
      </div>
    </div>

    <!-- Top Performers -->
    <div class="performers-card">
      <h3>ðŸ”¥ Top Tokens by Market Cap</h3>
      
      <div class="performer-list">
        <div *ngFor="let token of topPerformers; let i = index" 
             class="performer-item"
             (click)="navigateToToken(token.address)">
          <div class="performer-rank">{{ i + 1 }}</div>
          <div class="performer-info">
            <div class="performer-name">{{ token.symbol }}</div>
            <div class="performer-subtitle">{{ token.name }}</div>
          </div>
          <div class="performer-metrics">
            <div class="performer-price">{{ formatCurrency(token.currentPrice) }}</div>
            <div class="performer-mcap">{{ formatCurrency(token.marketCap) }}</div>
          </div>
        </div>
        
        <div *ngIf="topPerformers.length === 0" class="empty-state">
          <p>No tokens available</p>
        </div>
      </div>
    </div>

    <!-- Market Distribution -->
    <div class="distribution-card">
      <h3>Market Distribution (Top 8)</h3>
      
      <div class="distribution-bar">
        <div 
          *ngFor="let holding of holdings"
          [style.width.%]="holding.percentage"
          [style.background-color]="holding.color"
          class="distribution-segment"
          [title]="holding.token.symbol + ': ' + holding.percentage.toFixed(1) + '%'">
        </div>
      </div>
      
      <div class="distribution-legend">
        <div *ngFor="let holding of holdings" 
             class="legend-item"
             (click)="navigateToToken(holding.token.address)">
          <div class="legend-color" [style.background-color]="holding.color"></div>
          <div class="legend-info">
            <span class="legend-symbol">{{ holding.token.symbol }}</span>
            <span class="legend-value">{{ formatCurrency(holding.token.marketCap || 0) }}</span>
          </div>
          <span class="legend-percent">{{ holding.percentage.toFixed(1) }}%</span>
        </div>
      </div>
    </div>

    <!-- All Tokens Table -->
    <div class="tokens-card">
      <h3>All Tokens ({{ tokens.length }})</h3>
      
      <div class="tokens-table">
        <div class="table-header">
          <div class="col-rank">#</div>
          <div class="col-token">Token</div>
          <div class="col-price">Price</div>
          <div class="col-volume">24h Volume</div>
          <div class="col-mcap">Market Cap</div>
        </div>
        
        <div *ngFor="let token of tokens; let i = index" 
             class="table-row"
             (click)="navigateToToken(token.address)">
          <div class="col-rank">{{ i + 1 }}</div>
          <div class="col-token">
            <div class="token-symbol">{{ token.symbol }}</div>
            <div class="token-name">{{ token.name }}</div>
          </div>
          <div class="col-price">{{ formatCurrency(token.currentPrice) }}</div>
          <div class="col-volume">{{ formatCurrency(token.volume24h) }}</div>
          <div class="col-mcap">{{ formatCurrency(token.marketCap || 0) }}</div>
        </div>
        
        <div *ngIf="tokens.length === 0" class="empty-state">
          <p>No tokens available</p>
          <p-button routerLink="/" label="Browse Tokens" icon="pi pi-home"></p-button>
        </div>
      </div>
    </div>

  </div>
</div>
