<div class="analytics-page">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading analytics...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading">
    <!-- Page Header -->
    <div class="page-header">
      <h1>üìä Portfolio Analytics</h1>
      <p>Track your performance and gains</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!hasData" class="empty-state">
      <div class="empty-icon">üìà</div>
      <h2>Start Trading to See Analytics</h2>
      <p>Your portfolio performance, P&L, and trading metrics will appear here once you start trading.</p>
      <div class="empty-actions">
        <button class="btn-primary" routerLink="/">Browse Tokens</button>
        <button class="btn-secondary" (click)="addDemoData()">Load Demo Data</button>
      </div>
    </div>

    <!-- Analytics Content -->
    <div *ngIf="hasData" class="analytics-content">
      <!-- Portfolio Overview -->
      <div class="overview-grid">
        <div class="metric-card portfolio-value">
          <div class="metric-header">
            <span class="metric-icon">üí∞</span>
            <span class="metric-label">Total Portfolio Value</span>
          </div>
          <div class="metric-value">{{ formatCurrency(animatedTotalValue) }}</div>
          <div class="metric-change" [ngClass]="getChangeClass(portfolioSummary.totalChange24h)">
            {{ formatCurrency(portfolioSummary.totalChange24h) }} ({{ formatPercent(portfolioSummary.totalChangePercent24h) }}) 24h
          </div>
        </div>

        <div class="metric-card pnl-card">
          <div class="metric-header">
            <span class="metric-icon">üìà</span>
            <span class="metric-label">Total P&L</span>
          </div>
          <div class="metric-value" [ngClass]="getChangeClass(pnlData.total)">
            {{ formatCurrency(animatedPnL) }}
          </div>
          <div class="metric-change" [ngClass]="getChangeClass(pnlData.totalPercent)">
            {{ formatPercent(pnlData.totalPercent) }} return
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-icon">‚úÖ</span>
            <span class="metric-label">Realized P&L</span>
          </div>
          <div class="metric-value" [ngClass]="getChangeClass(pnlData.realized)">
            {{ formatCurrency(pnlData.realized) }}
          </div>
          <div class="metric-sub">
            {{ formatPercent(pnlData.realizedPercent) }}
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-icon">‚è≥</span>
            <span class="metric-label">Unrealized P&L</span>
          </div>
          <div class="metric-value" [ngClass]="getChangeClass(pnlData.unrealized)">
            {{ formatCurrency(pnlData.unrealized) }}
          </div>
          <div class="metric-sub">
            {{ formatPercent(pnlData.unrealizedPercent) }}
          </div>
        </div>
      </div>

      <!-- Performance Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Portfolio Performance</h3>
          <div class="timeframe-selector">
            <button
              [class.active]="selectedTimeframe === '1D'"
              (click)="selectTimeframe('1D')">1D</button>
            <button
              [class.active]="selectedTimeframe === '1W'"
              (click)="selectTimeframe('1W')">1W</button>
            <button
              [class.active]="selectedTimeframe === '1M'"
              (click)="selectTimeframe('1M')">1M</button>
            <button
              [class.active]="selectedTimeframe === 'ALL'"
              (click)="selectTimeframe('ALL')">ALL</button>
          </div>
        </div>
        
        <div class="chart-content">
          <app-performance-chart
            [data]="performanceData"
            [timeRange]="selectedTimeframe"
            [height]="300">
          </app-performance-chart>
        </div>
      </div>

      <!-- Top Performers -->
      <div class="performers-section">
        <div class="performers-card best">
          <app-top-performers
            [performers]="topPerformers"
            [title]="'üî• Top Performers'"
            [showBadge]="true"
            (tokenClick)="navigateToToken($event)">
          </app-top-performers>
        </div>

        <div class="performers-card worst" *ngIf="worstPerformers.length > 0">
          <app-top-performers
            [performers]="worstPerformers"
            [title]="'‚ùÑÔ∏è Worst Performers'"
            [showBadge]="false"
            (tokenClick)="navigateToToken($event)">
          </app-top-performers>
        </div>
      </div>

      <!-- Trading Activity -->
      <div class="activity-card">
        <h3>üìä Trading Activity Summary</h3>
        
        <div class="activity-grid">
          <div class="activity-metric">
            <div class="activity-icon">üî¢</div>
            <div class="activity-info">
              <div class="activity-label">Total Trades</div>
              <div class="activity-value">{{ tradingActivity.totalTrades }}</div>
              <div class="activity-sub">
                {{ tradingActivity.buyCount }} buys, {{ tradingActivity.sellCount }} sells
              </div>
            </div>
          </div>

          <div class="activity-metric">
            <div class="activity-icon">üíµ</div>
            <div class="activity-info">
              <div class="activity-label">Total Volume</div>
              <div class="activity-value">{{ formatCurrency(tradingActivity.totalVolume) }}</div>
              <div class="activity-sub">
                Avg: {{ formatCurrency(tradingActivity.avgTradeSize) }}
              </div>
            </div>
          </div>

          <div class="activity-metric">
            <div class="activity-icon">üí∏</div>
            <div class="activity-info">
              <div class="activity-label">Fees Paid</div>
              <div class="activity-value negative">{{ formatCurrency(tradingActivity.totalFeesPaid) }}</div>
              <div class="activity-sub">
                Transaction costs
              </div>
            </div>
          </div>

          <div class="activity-metric">
            <div class="activity-icon">üéØ</div>
            <div class="activity-info">
              <div class="activity-label">Largest Trade</div>
              <div class="activity-value">{{ formatCurrency(tradingActivity.largestTrade) }}</div>
              <div class="activity-sub">
                Single transaction
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Portfolio Tokens Count -->
      <div class="tokens-info">
        <p>Currently tracking {{ portfolioSummary.tokenCount }} {{ portfolioSummary.tokenCount === 1 ? 'token' : 'tokens' }} in your portfolio</p>
        <p class="last-updated">Last updated: {{ formatTimestamp(portfolioSummary.lastUpdated) }}</p>
      </div>
    </div>

    <!-- Wallet Not Connected -->
    <div *ngIf="!walletConnected && !hasData" class="wallet-prompt">
      <p>Connect your wallet to see personalized analytics</p>
      <button class="btn-primary" (click)="connectWallet()">
        <span class="wallet-icon">üëõ</span>
        Connect Wallet
      </button>
    </div>
  </div>
</div>
